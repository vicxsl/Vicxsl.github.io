---
title: Redis
article: false
date: 2021-11-11 18:55:16
pageClass: custom-page-class
permalink: /pages/f0ea5a/
---
# Redis

```markmap
# Redis 
* `高性能非关系型（NoSQL）的键值对数据库`
* 优点
    - 读写性能优异 `读110000次/S，写81000次/S`
    - 支持持久化 `AOF和RDB两种模式`
    - 支持事务`所有操作都是原子性的`
    - 数据结构丰富 `支持hash，set，list`
    - 支持主从复制
- 缺点
    - 收物理内存限制
    - 不支持容错和恢复功能
    - 主机宕机风险，降低系统可用性
- Redis为什么这么快
    - 数据存在内存中
    - 数据结构简单
    - 采用单线程，避免上下文切换和竞争条件
    - 使用多路IO复用，非阻塞IO
- 使用
    - 数据类型
        - String`字符串`
            - 短信验证码
            - 配置信息
        - List`列表型`
            - 省市区
        - Set`交集、并集、差集`
            - 共同好友
        - Zset`有序集合`
            - 排行版
        - Hash`无序散列表、键值对`
            - 商品详情
            - 个人信息详情
- 应用场景
    - 计数器
    - 缓存
        - 热点数据
    - 会话缓存
        - 服务器会话信息
    - 全页缓存
    - 消息队列(发布/订阅功能)
        - List 是一个双向链表
        - 通过 lpush 和 rpop 写入和读取消息
        - 最好使用 Kafka、RabbitMQ
    - Set
        - 可以实现交集、并集等操作
        - 共同好友
- 持节化`内存数据写道磁盘中`
    - RDB`Redis DataBase 快照`
        - 只有一个文件，方便持久化
        - 性能最大化
        - 启动效率高
        - 数据丢失
    - AOF
        - 文件大
        - 启动效率低
        - 安全性大
- 内存相关
    - 淘汰策略`内存上升到一定大小`
        - 写报错
        - 处理过期的缓存数据
        - 冲刷旧数据
- 事务
    - 事务开始 MULTI
    - 命令入队
    - 事务执行 EXEC
- 分布式锁
    - Redis单进程单线程
    - 队列模式将并发访问变成串行访问
    - 使用setx，当key不存在，将key的值设置为value
    - 设置成功返回1，设置失败返回0
- 缓存异常
    - 缓存雪崩`大面积失效`
        - 随机过期时间
        - 加锁排队
        - 缓存标记，更新数据缓存
    - 缓存穿透`请求都落到数据库`
        - 接口层增加校验，拦截部分请求
        - 缓存和数据库都取不到的数据，设置为key-null
        - 布隆过滤器
            - 可能存在的数据哈希到一个bitmap
            - 利用多个Hash
            - 当所有Hash函数在集合中，才能确定元素在集合中
```