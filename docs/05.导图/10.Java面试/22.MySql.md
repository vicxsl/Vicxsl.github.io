---
title: Mysql
article: false
date: 2021-11-11 18:55:16
pageClass: custom-page-class
permalink: /pages/7f3642/
---
# Mysql

```markmap
# Mysql 
* 表设计
	- 三大范式
		- 每个列不可拆分
		- 非主键完全依赖逐渐
		- 非主键之依赖主键，不能依赖其他非主键
- 存储引擎（Storage engine）
	- innodb引擎（默认）
		- 支持事务
			- 默认不适用事务
		- 聚簇索引
		- 主键索引非常高效
		- 并发量高和事务
	- MyIASM引擎(原本Mysql的默认引擎)
		- 不支持事务
		- 非聚簇索引
		- 适合读写为主
	- MEMORY引擎：所有的数据都在内存中
- 索引
	- 优点
		- 加快数据检索
		- 优化隐藏器
	- 缺点
		- 创建和维护索引需要时间，降低更新效率
		- 索引占用物理空间
	- **创建索引的原则**
		- 最左匹配，向右匹配到范围查询
		- 频繁查询的字段
		- 频繁更新的字段不适合
		- 外键的数据列一定要创建索引
		- 类型数据量大的不要创建索引
	- 使用场景
		- where
		- order by
			- 所有数据从磁盘读取到内存进行排序很耗时
		- join
			- 对连接字段建立索引提升效率
		- like
			- 会使索引失效
	- 类型
		- 主键索引
			- 不能为null
			- 只能有一个主键
		- 唯一索引
			- 数据不允许重复
		- 普通索引
		- 全文索引
	- **数据结构**
		- B+树索引（=,>,>=,<,<=和between）
			- 原理
				- 最常见的索引
				- 叶子结点保存了关键字信息和指针
				- 非叶子节点都是索引部分
				- 数据的插入和删除在叶子节点进行
			- 特点
				- 稳定性该，查询速度快
		- B树
			- 内部节点可以同时存储键和值
		- 哈希索引（=）
			- 原理
				- Hash算法
				- 字段数据转换成定长的Hash值
			- 特点
				- hash索引等值查询更快
				- 无法进行范围索引
				- 不支持排序
	- 使用方式
		- CREATE TABLE
			- KEY
		- ALTER TABLE
			- ADD INDEX
		- CREATE INDEX
		- drop primary key
- 数据类型
	- 整数
		- tinyInt
		- smallint
		- mediumint
		- int(integer)
	- 小数
		- float
		- double
		- decimal(m,d) 效率低一点
	- 日期
		- year
		- time
		- date
		- datetime
		- timestamp 推荐
	- 文本、二进制
		- CHAR(M) 效率高
		- VARCHAR(M)
		- TINYBLOB
		- BLOB 额外性能开销
		- ....
		- TEXT
- 数据库事务
	- ACID
		- 原子性
		- 一致性
		- 隔离性
		- 持久性
	- 隔离级别
		- READ-UNCOMMITTED(读取未提交) 脏读
		- REPEATABLE-READ(可重复读) 幻读，不可重复度
		- READ-COMMITTED(读取已提交) 不可重复读
		- SERIALIZABLE(可串行化)
- 锁
	- 类型
		- 行级锁(INNODB引擎)
			- 只针对当前操作的行进行加锁
			- 开销大，加锁慢
			- 锁冲突的概率最低
			- 并发度高
		- 表级锁(MYISAM引擎)
			- 开销小，加锁快
			- 发出锁冲突的概率最高
			- 并发度最低
		- 页级锁(BDB引擎 )
			- 开销和加锁时间界于表锁和行锁之间
	- 死锁`多个事务在同一资源上相互占用，并请求锁定对方的资源`
		- 乐观锁`多读`
		- 悲观锁`多写`
	- SQL语句
		- 分类
			- DDL
			- DQL
			- DML
			- DCL
		- 连接查询
			- 内连接
			- 外连接
				- 左外
				- 右外
			- 交叉连接
		- 子查询
		- 关键字语句
			- in 小表
			- exits 大表
			- limit
			- rowNum
	- SQL优化
		- 常规
			- 尽量不用 select *
			- 减少子查询
			- 尽量少用in和not in
			- 尽量避免 ！= 或 < > 操作符
			- 避免在where做null值判断
		- 执行计划`explan`
			- 查看是否使用索引
			- 访问类型
				- ALL 扫描全表
				- index 遍历索引
		- 大表数据量查询
			- 优化schema、sql语句+索引
			- 加缓存 memcached, redis
			- 主从复制、读写分离
			- 垂直拆分 （按字段）
			- 水平拆分（分表）
		- 存储过程
			- CREATE PROCEDURE
```